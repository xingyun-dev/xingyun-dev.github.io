<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【4】在测试集上评估模型精度 | 星云文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <meta name="description" content="作为个人的项目文档">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="星云文档,vuepress,自建博客">
    <meta name="robots" content="all">
    <meta name="author" content="星云">
    
    <link rel="preload" href="/assets/css/0.styles.b432410e.css" as="style"><link rel="preload" href="/assets/js/app.94050fe9.js" as="script"><link rel="preload" href="/assets/js/3.1d401efd.js" as="script"><link rel="preload" href="/assets/js/1.5d58ef4f.js" as="script"><link rel="preload" href="/assets/js/26.91340062.js" as="script"><link rel="preload" href="/assets/js/13.97938b40.js" as="script"><link rel="preload" href="/assets/js/10.ea0a4944.js" as="script"><link rel="prefetch" href="/assets/js/11.8bb40106.js"><link rel="prefetch" href="/assets/js/12.c8122184.js"><link rel="prefetch" href="/assets/js/14.34880c79.js"><link rel="prefetch" href="/assets/js/15.2cfb373d.js"><link rel="prefetch" href="/assets/js/16.5e7e3d44.js"><link rel="prefetch" href="/assets/js/17.4b205fed.js"><link rel="prefetch" href="/assets/js/18.aeed4305.js"><link rel="prefetch" href="/assets/js/19.c02ba525.js"><link rel="prefetch" href="/assets/js/20.d7c46cbe.js"><link rel="prefetch" href="/assets/js/21.83905f3c.js"><link rel="prefetch" href="/assets/js/22.1368af34.js"><link rel="prefetch" href="/assets/js/23.4924f8f7.js"><link rel="prefetch" href="/assets/js/24.3c1e82be.js"><link rel="prefetch" href="/assets/js/25.ba6615b5.js"><link rel="prefetch" href="/assets/js/27.faaa2260.js"><link rel="prefetch" href="/assets/js/28.a4c7c0e0.js"><link rel="prefetch" href="/assets/js/29.c491cfa9.js"><link rel="prefetch" href="/assets/js/30.80f389a0.js"><link rel="prefetch" href="/assets/js/31.3ea0207c.js"><link rel="prefetch" href="/assets/js/32.6f1edb99.js"><link rel="prefetch" href="/assets/js/33.c82abb2f.js"><link rel="prefetch" href="/assets/js/34.f26cde16.js"><link rel="prefetch" href="/assets/js/35.c9cb06cc.js"><link rel="prefetch" href="/assets/js/36.719cdfe2.js"><link rel="prefetch" href="/assets/js/37.6fb87db9.js"><link rel="prefetch" href="/assets/js/38.4fa0e8a4.js"><link rel="prefetch" href="/assets/js/39.ab10d1d9.js"><link rel="prefetch" href="/assets/js/4.ecab215c.js"><link rel="prefetch" href="/assets/js/40.4403d8fd.js"><link rel="prefetch" href="/assets/js/41.b77cb84d.js"><link rel="prefetch" href="/assets/js/42.e50d24f9.js"><link rel="prefetch" href="/assets/js/5.9c8d591a.js"><link rel="prefetch" href="/assets/js/6.72e9cdce.js"><link rel="prefetch" href="/assets/js/7.33d3d58d.js"><link rel="prefetch" href="/assets/js/8.68313a62.js"><link rel="prefetch" href="/assets/js/9.77efff30.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b432410e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>星云文档</h3> <p class="description" data-v-59e6cb88>作为个人的项目文档</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>星云</span>
          
        <span data-v-59e6cb88>2024 - </span>
        2025
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="星云文档" class="logo"> <span class="site-name">星云文档</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      项目文档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/guide/" class="nav-link"><i class="undefined"></i>
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/docs/vuepress搭建个人文档/" class="nav-link"><i class="undefined"></i>
  vuepress搭建个人文档
</a></li><li class="dropdown-item"><!----> <a href="/docs/以flask为后端的博客项目/" class="nav-link"><i class="undefined"></i>
  以flask为后端的博客项目
</a></li><li class="dropdown-item"><!----> <a href="/docs/三叶青图像识别项目/" class="nav-link"><i class="undefined"></i>
  三叶青图像识别项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/介绍/" class="nav-link"><i class="undefined"></i>
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/categories/项目/" class="nav-link"><i class="undefined"></i>
  项目
</a></li><li class="dropdown-item"><!----> <a href="/categories/留言板/" class="nav-link"><i class="undefined"></i>
  留言板
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于项目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/xingyun-dev" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/wht050106" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/docs/留言板.html" class="nav-link"><i class="undefined"></i>
  留言板
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/img/logo.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    星云
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>27</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>5</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-blog"></i>
      项目文档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/guide/" class="nav-link"><i class="undefined"></i>
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/docs/vuepress搭建个人文档/" class="nav-link"><i class="undefined"></i>
  vuepress搭建个人文档
</a></li><li class="dropdown-item"><!----> <a href="/docs/以flask为后端的博客项目/" class="nav-link"><i class="undefined"></i>
  以flask为后端的博客项目
</a></li><li class="dropdown-item"><!----> <a href="/docs/三叶青图像识别项目/" class="nav-link"><i class="undefined"></i>
  三叶青图像识别项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/介绍/" class="nav-link"><i class="undefined"></i>
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/categories/项目/" class="nav-link"><i class="undefined"></i>
  项目
</a></li><li class="dropdown-item"><!----> <a href="/categories/留言板/" class="nav-link"><i class="undefined"></i>
  留言板
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于项目
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/xingyun-dev" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/wht050106" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/docs/留言板.html" class="nav-link"><i class="undefined"></i>
  留言板
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>三叶青图像识别项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/" aria-current="page" class="sidebar-link">三叶青图像识别研究简概</a></li><li><a href="/docs/三叶青图像识别项目/【1】构建图像分类数据集.html" class="sidebar-link">【1】构建图像分类数据集</a></li><li><a href="/docs/三叶青图像识别项目/【2】模型训练准备.html" class="sidebar-link">【2】模型训练准备</a></li><li><a href="/docs/三叶青图像识别项目/【3】迁移学习模型.html" class="sidebar-link">【3】迁移学习模型</a></li><li><a href="/docs/三叶青图像识别项目/【4】在测试集上评估模型精度.html" class="active sidebar-link">【4】在测试集上评估模型精度</a></li><li><a href="/docs/三叶青图像识别项目/【6】图像分类部署.html" class="sidebar-link">【6】图像分类部署</a></li><li><a href="/docs/三叶青图像识别项目/【7】树莓派图像分类部署.html" class="sidebar-link">【7】树莓派图像分类部署</a></li><li><a href="/docs/三叶青图像识别项目/【8】相关补充.html" class="sidebar-link">【8】相关补充</a></li><li><a href="/docs/三叶青图像识别项目/阶段总结——基于深度学习的三叶青图像识别.html" class="sidebar-link">阶段总结——基于深度学习的三叶青图像识别</a></li><li><a href="/docs/三叶青图像识别项目/使用flask的web网页部署介绍.html" class="sidebar-link">使用flask的web网页部署介绍</a></li><li><a href="/docs/三叶青图像识别项目/微信小程序部署.html" class="sidebar-link">微信小程序部署</a></li><li><a href="/docs/三叶青图像识别项目/使用pyqt界面化部署.html" class="sidebar-link">使用pyqt界面化部署</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>【4】在测试集上评估模型精度</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>星云</span>
          
        <span data-v-59e6cb88>2024 - </span>
        2025
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">【4】在测试集上评估模型精度</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>星云</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2024/7/5</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>图像分类</span></i></div></div> <div class="theme-reco-content content__default"><hr> <blockquote><p>【4】在测试集上评估模型精度</p></blockquote> <hr> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>将训练好的模型应用在测试集上，评估模型的效果</p> <hr> <h2 id="一、评估指标代码"><a href="#一、评估指标代码" class="header-anchor">#</a> 一、评估指标代码</h2> <h3 id="_1-1-各类别准确率评估指标"><a href="#_1-1-各类别准确率评估指标" class="header-anchor">#</a> 1.1. 各类别准确率评估指标</h3> <blockquote><p>包括precision,recall,f1-score,support,accuracy,AP,AUC值的表格以及测试集预测结果表格</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">predict_</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>num_classes<span class="token punctuation">,</span>model_name<span class="token punctuation">,</span>model_weight_pth<span class="token punctuation">,</span>classes<span class="token punctuation">,</span>model_leibie<span class="token punctuation">,</span>model_path_zheng<span class="token punctuation">,</span>is_zheng<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    img: #测试图片路径
    num_classes : #类别数量：10、5、2
    model_name ： #模型名称
    model_weight_pth : #待读取的模型权重的保存路径
    classes： #索引与标签的字典
    model_leibie: #模型类别
    model_path_zheng: #整体模型路径
    is_zheng: #是否整体模型
    &quot;&quot;&quot;</span>
    <span class="token comment">#定义了数据转换的操作。通过transforms.ToTensor()将图像转换为张量，transforms.Normalize()对图像进行归一化处理</span>
    data_transform <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
         transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token comment"># 从图像中心裁切224x224大小的图片</span>
         transforms<span class="token punctuation">.</span>CenterCrop<span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.485</span><span class="token punctuation">,</span> <span class="token number">0.456</span><span class="token punctuation">,</span> <span class="token number">0.406</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                     <span class="token punctuation">[</span><span class="token number">0.229</span><span class="token punctuation">,</span> <span class="token number">0.224</span><span class="token punctuation">,</span> <span class="token number">0.225</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 有 GPU就用 GPU，没有就用 CPU</span>
    devices <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda:0'</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'cpu'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> img<span class="token punctuation">.</span>mode <span class="token operator">==</span> <span class="token string">'RGBA'</span><span class="token punctuation">:</span>  <span class="token comment">#如果图像是RGBA模式，就将其转换为RGB模式</span>
        img <span class="token operator">=</span> img<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> data_transform<span class="token punctuation">(</span>img<span class="token punctuation">)</span> <span class="token comment">#将输入图像应用数据转换操作</span>
    img <span class="token operator">=</span> torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>img<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">#在第0维度上添加一个维度，用于适配网络输入</span>
    img <span class="token operator">=</span> img<span class="token punctuation">.</span>to<span class="token punctuation">(</span>devices<span class="token punctuation">)</span>   <span class="token comment"># 将张量移动到GPU上  </span>
    <span class="token keyword">if</span> is_zheng<span class="token punctuation">:</span>
        model <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_path_zheng<span class="token punctuation">,</span>map_location<span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#直接加载整个模型</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> get_net<span class="token punctuation">(</span>devices<span class="token punctuation">,</span>num_classes<span class="token punctuation">,</span>model_name<span class="token punctuation">,</span>model_leibie<span class="token punctuation">)</span>   <span class="token comment">#实例化的image_classifier</span>
        model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_weight_pth<span class="token punctuation">,</span>map_location<span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#指定了模型权重文件路径，并加载权重到模型中</span>
    model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#将模型设置为评估模式，即关闭Dropout和Batch Normalization的随机性</span>
    <span class="token comment">#将输入图像输入模型中进行推理</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        output <span class="token operator">=</span> torch<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>model<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">)</span>
        predict <span class="token operator">=</span> torch<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>output<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取每个类别的预测概率</span>
    class_probs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">round</span><span class="token punctuation">(</span>prob<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> prob <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>predict<span class="token punctuation">)</span><span class="token punctuation">}</span>
    predict_cla <span class="token operator">=</span> torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>predict<span class="token punctuation">)</span><span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    max_prob <span class="token operator">=</span> <span class="token builtin">round</span><span class="token punctuation">(</span>predict<span class="token punctuation">[</span>predict_cla<span class="token punctuation">]</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
    predicted_class <span class="token operator">=</span> classes<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>predict_cla<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> predicted_class<span class="token punctuation">,</span> max_prob<span class="token punctuation">,</span> class_probs



<span class="token comment">#测试集预测结果、各类别准确率评估指标</span>
<span class="token keyword">def</span> <span class="token function">predict_acc_all</span><span class="token punctuation">(</span>labels_path<span class="token punctuation">,</span>image_dir<span class="token punctuation">,</span>num_classes<span class="token punctuation">,</span>model_name<span class="token punctuation">,</span>model_weight_pth<span class="token punctuation">,</span>classes<span class="token punctuation">,</span>model_leibie<span class="token punctuation">,</span>model_path_zheng<span class="token punctuation">,</span>is_zheng<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#计算在测试集上的准确率</span>
        labels_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>labels_path<span class="token punctuation">)</span>  <span class="token comment">#假设labels.csv的格式是：ID,labels</span>
        true_labels <span class="token operator">=</span> <span class="token punctuation">{</span>row<span class="token punctuation">[</span><span class="token string">'ID'</span><span class="token punctuation">]</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token string">'labels'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> _<span class="token punctuation">,</span> row <span class="token keyword">in</span> labels_df<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token comment"># 创建一个字典来存储真实标签</span>
        img_path_lt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">#图片路径</span>
        predicted_class_topn_lt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">#top_n预测类别</span>
        top_n <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 初始化 top_n 列表</span>
        true_class_lt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">#真实类别</span>
        class_probs_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">#每个类型的置信度</span>
        correct_count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 初始化计数器</span>
        total_count <span class="token operator">=</span> <span class="token number">0</span>
        photo_count <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">#初始化图片计数器</span>
        <span class="token keyword">import</span> time
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 开始计时</span>
        <span class="token comment"># 遍历未知图片目录</span>
    <span class="token comment">#     image_dir = r&quot;/kaggle/working/my_directory_shi/train_valid_test/test/unknown/&quot;</span>
        <span class="token keyword">for</span> filename <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>image_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> filename<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">&quot;.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 根据你的图片文件类型调整</span>
                photo_count <span class="token operator">+=</span> <span class="token number">1</span> <span class="token comment">#图片个数统计</span>
                base_name <span class="token operator">=</span> filename<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>   <span class="token comment"># 移除文件名的后缀以匹配labels.csv中的ID</span>
                img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>image_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
                img_path_lt<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>  <span class="token comment">#存储图片的路径</span>
                predicted_class<span class="token punctuation">,</span> max_prob<span class="token punctuation">,</span>class_probs <span class="token operator">=</span> predict_<span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>img_path<span class="token punctuation">)</span><span class="token punctuation">,</span>num_classes<span class="token punctuation">,</span>model_name<span class="token punctuation">,</span>model_weight_pth<span class="token punctuation">,</span>classes<span class="token punctuation">,</span>model_leibie<span class="token punctuation">,</span>model_path_zheng<span class="token punctuation">,</span>is_zheng<span class="token punctuation">)</span> <span class="token comment"># 预测</span>
                class_probs_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>class_probs<span class="token punctuation">)</span>
                <span class="token comment"># 对 class_probs 字典进行排序，返回一个列表，列表的每个元素是一个元组，元组的第一个元素是键，第二个元素是值</span>
                sorted_class_probs <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>class_probs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                <span class="token comment"># 取前三个元素</span>
                top3_class_probs <span class="token operator">=</span> sorted_class_probs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token comment">#                 print(top3_class_probs)</span>
                <span class="token comment"># 将 top3_class_probs 添加到 predicted_class_topn_lt 列表中</span>
                predicted_class_topn_lt<span class="token punctuation">.</span>append<span class="token punctuation">(</span>top3_class_probs<span class="token punctuation">)</span>
                
                true_class <span class="token operator">=</span> true_labels<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>base_name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 获取真实类别，这里使用去除后缀的base_name来查找</span>
                true_class_lt<span class="token punctuation">.</span>append<span class="token punctuation">(</span>true_class<span class="token punctuation">)</span>
<span class="token comment">#                 检查 top3_class_probs 是否包含真实类别</span>
                <span class="token keyword">if</span> true_class <span class="token keyword">in</span> <span class="token punctuation">[</span>classes<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> top3_class_probs<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    top_n<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    top_n<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#                 print(top_n)</span>
<span class="token comment">#                 print(f'真实：{true_class}',f&quot;预测：{predicted_class}&quot;,f&quot;最大概率：{max_prob}&quot;,f&quot;所有概率:{class_probs}&quot;)</span>
                <span class="token keyword">if</span> true_class <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;警告：找不到ID为</span><span class="token interpolation"><span class="token punctuation">{</span>base_name<span class="token punctuation">}</span></span><span class="token string">在labels.csv中的标签，跳过此文件。&quot;</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">if</span> <span class="token builtin">str</span><span class="token punctuation">(</span>predicted_class<span class="token punctuation">)</span> <span class="token operator">==</span> true_class<span class="token punctuation">:</span>   <span class="token comment"># 更新计数器</span>
                    correct_count <span class="token operator">+=</span> <span class="token number">1</span>
                total_count <span class="token operator">+=</span> <span class="token number">1</span>

        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 结束计时</span>
        total_time <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time  <span class="token comment"># 总处理时间</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;总耗时: </span><span class="token interpolation"><span class="token punctuation">{</span>total_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">秒&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;测试集图片数: </span><span class="token interpolation"><span class="token punctuation">{</span>photo_count<span class="token punctuation">}</span></span><span class="token string">张&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;每张图片耗时photo_time：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token punctuation">(</span>total_time<span class="token operator">/</span>photo_count<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">2f</span><span class="token punctuation">}</span></span><span class="token string">秒&quot;</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 创建一个字典，其中键是列名，值是数据</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'img_path'</span><span class="token punctuation">:</span> img_path_lt<span class="token punctuation">,</span>
            <span class="token string">'true_class'</span><span class="token punctuation">:</span> true_class_lt<span class="token punctuation">,</span>
            <span class="token string">'top_n预测正确'</span><span class="token punctuation">:</span> top_n
        <span class="token punctuation">}</span>
        
        <span class="token comment"># 使用循环来添加 top-n 预测类别和置信度的列</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            data<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f'top-</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">-predicted-class'</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>classes<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> predicted_class_topn_lt<span class="token punctuation">]</span>
            data<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f'top-</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">-probs'</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>item<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> predicted_class_topn_lt<span class="token punctuation">]</span>

        <span class="token comment"># 将每个类别的置信度添加到数据字典中</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_classes<span class="token punctuation">)</span><span class="token punctuation">:</span>
            i_c <span class="token operator">=</span> classes<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span>
            data<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f'class_</span><span class="token interpolation"><span class="token punctuation">{</span>i_c<span class="token punctuation">}</span></span><span class="token string">_prob'</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>class_probs<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> class_probs <span class="token keyword">in</span> class_probs_list<span class="token punctuation">]</span>
        <span class="token comment"># 创建 DataFrame</span>
        df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token comment"># 保存为 csv 文件</span>
        df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'测试集预测结果.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token comment"># print(df)</span>
        <span class="token comment"># 计算准确率</span>
        accuracy <span class="token operator">=</span> correct_count <span class="token operator">/</span> total_count <span class="token keyword">if</span> total_count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;==============================================&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;预测准确率test_acc：</span><span class="token interpolation"><span class="token punctuation">{</span>accuracy <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%&quot;</span></span><span class="token punctuation">)</span>
        <span class="token comment"># 计算 top_n 预测正确的概率</span>
        top_n_accuracy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'top_n预测正确'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'top_n预测正确'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;top_n 预测正确的概率是 </span><span class="token interpolation"><span class="token punctuation">{</span>top_n_accuracy<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%&quot;</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=======================================&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;分类报告与各类别准确率&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'top-1-predicted-class'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> target_names<span class="token operator">=</span>classes<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        report <span class="token operator">=</span> classification_report<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'top-1-predicted-class'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> target_names<span class="token operator">=</span>classes<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> output_dict<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">del</span> report<span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span>
        df_report <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>report<span class="token punctuation">)</span><span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># print(df_report)</span>
        <span class="token comment">#各类别准确率</span>
        accuracy_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> sanye <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>classes<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            df_temp <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span><span class="token operator">==</span>sanye<span class="token punctuation">]</span>
            accuracy <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>df_temp<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> df_temp<span class="token punctuation">[</span><span class="token string">'top-1-predicted-class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df_temp<span class="token punctuation">)</span>
            accuracy_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>accuracy<span class="token punctuation">)</span>
        <span class="token comment"># 计算 宏平均准确率 和 加权平均准确率</span>
        acc_macro <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>accuracy_list<span class="token punctuation">)</span>
        acc_weighted <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>accuracy_list <span class="token operator">*</span> df_report<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'support'</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">)</span>
        accuracy_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>acc_macro<span class="token punctuation">)</span>
        accuracy_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>acc_weighted<span class="token punctuation">)</span>
        df_report<span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span> <span class="token operator">=</span> accuracy_list
        <span class="token keyword">print</span><span class="token punctuation">(</span>df_report<span class="token punctuation">)</span>
        df_report<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'各类别准确率评估指标.csv'</span><span class="token punctuation">,</span> index_label<span class="token operator">=</span><span class="token string">'类别'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br></div></div><h3 id="_1-2-混淆矩阵可视化"><a href="#_1-2-混淆矩阵可视化" class="header-anchor">#</a> 1.2. 混淆矩阵可视化</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#混淆矩阵</span>
<span class="token keyword">def</span> <span class="token function">cnf_matrix_plotter</span><span class="token punctuation">(</span>classes<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    传入混淆矩阵和标签名称列表，绘制混淆矩阵
    &quot;&quot;&quot;</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'测试集预测结果.csv'</span><span class="token punctuation">)</span>
    cm <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'top-1-predicted-class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>cm<span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token string">'nearest'</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span>cmap<span class="token punctuation">)</span>
    <span class="token comment"># plt.colorbar() # 色条</span>
    tick_marks <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>classes<span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'混淆矩阵'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'预测类别'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'真实类别'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment"># 设置类别文字大小</span>
    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>tick_marks<span class="token punctuation">,</span> classes<span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span> <span class="token comment"># 横轴文字旋转</span>
    plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span>tick_marks<span class="token punctuation">,</span> classes<span class="token punctuation">)</span>
    <span class="token comment"># 写数字</span>
    threshold <span class="token operator">=</span> cm<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>cm<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cm<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">,</span> cm<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span><span class="token punctuation">,</span>
                 horizontalalignment<span class="token operator">=</span><span class="token string">&quot;center&quot;</span><span class="token punctuation">,</span>
                 color<span class="token operator">=</span><span class="token string">&quot;white&quot;</span> <span class="token keyword">if</span> cm<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> threshold <span class="token keyword">else</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
                 fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>

    plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'混淆矩阵.pdf'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token comment"># 保存图像</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 查看所有配色方案</span>
    <span class="token comment"># dir(plt.cm)</span>
    <span class="token keyword">return</span> cm
<span class="token comment"># df = pd.read_csv('测试集预测结果.csv', encoding='utf-8')</span>
<span class="token comment"># cnf_matrix_plotter(df, classes, cmap='Blues')</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_1-3-真实为a类-但被误判为b类的图像"><a href="#_1-3-真实为a类-但被误判为b类的图像" class="header-anchor">#</a> 1.3. 真实为A类，但被误判为B类的图像</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#筛选出测试集中，真实为A类，但被误判为B类的图像</span>
<span class="token keyword">def</span> <span class="token function">get_wrong_predict</span><span class="token punctuation">(</span>true_A<span class="token punctuation">,</span>pred_B<span class="token punctuation">,</span>is_plt<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'测试集预测结果.csv'</span><span class="token punctuation">)</span>
    wrong_df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span><span class="token operator">==</span>true_A<span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'top-1-predicted-class'</span><span class="token punctuation">]</span><span class="token operator">==</span>pred_B<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment">#可视化上表中所有被误判的图像</span>
    <span class="token keyword">if</span> is_plt<span class="token punctuation">:</span>
        <span class="token keyword">for</span> idx<span class="token punctuation">,</span> row <span class="token keyword">in</span> wrong_df<span class="token punctuation">.</span>iterrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            img_path <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token string">'img_path'</span><span class="token punctuation">]</span>
            img_bgr <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
            <span class="token keyword">if</span> img_bgr <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;无法读取图像：</span><span class="token interpolation"><span class="token punctuation">{</span>img_path<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                img_rgb <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img_bgr<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>
                plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_rgb<span class="token punctuation">)</span>
                title_str <span class="token operator">=</span> img_path <span class="token operator">+</span> <span class="token string">'\nTrue:'</span> <span class="token operator">+</span> row<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">' Pred:'</span> <span class="token operator">+</span> row<span class="token punctuation">[</span><span class="token string">'top-1-predicted-class'</span><span class="token punctuation">]</span>
                plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title_str<span class="token punctuation">)</span>
                plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> wrong_df
<span class="token comment"># df = pd.read_csv('测试集预测结果.csv')</span>
<span class="token comment"># wrong_df = get_wrong_predict(df,'YNKM','SXXA',is_plt=True)</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_1-4-pr曲线"><a href="#_1-4-pr曲线" class="header-anchor">#</a> 1.4. PR曲线</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token comment">#PR曲线</span>
<span class="token keyword">def</span> <span class="token function">get_line_arg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    随机产生一种绘图线型
    '''</span>
    colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'m'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'k'</span><span class="token punctuation">,</span> <span class="token string">'tab:blue'</span><span class="token punctuation">,</span> <span class="token string">'tab:orange'</span><span class="token punctuation">,</span> <span class="token string">'tab:green'</span><span class="token punctuation">,</span> <span class="token string">'tab:red'</span><span class="token punctuation">,</span> <span class="token string">'tab:purple'</span><span class="token punctuation">,</span> <span class="token string">'tab:brown'</span><span class="token punctuation">,</span> <span class="token string">'tab:pink'</span><span class="token punctuation">,</span> <span class="token string">'tab:gray'</span><span class="token punctuation">,</span> <span class="token string">'tab:olive'</span><span class="token punctuation">,</span> <span class="token string">'tab:cyan'</span><span class="token punctuation">,</span> <span class="token string">'black'</span><span class="token punctuation">,</span> <span class="token string">'indianred'</span><span class="token punctuation">,</span> <span class="token string">'brown'</span><span class="token punctuation">,</span> <span class="token string">'firebrick'</span><span class="token punctuation">,</span> <span class="token string">'maroon'</span><span class="token punctuation">,</span> <span class="token string">'darkred'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'sienna'</span><span class="token punctuation">,</span> <span class="token string">'chocolate'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span> <span class="token string">'olivedrab'</span><span class="token punctuation">,</span> <span class="token string">'yellowgreen'</span><span class="token punctuation">,</span> <span class="token string">'darkolivegreen'</span><span class="token punctuation">,</span> <span class="token string">'forestgreen'</span><span class="token punctuation">,</span> <span class="token string">'limegreen'</span><span class="token punctuation">,</span> <span class="token string">'darkgreen'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'lime'</span><span class="token punctuation">,</span> <span class="token string">'seagreen'</span><span class="token punctuation">,</span> <span class="token string">'mediumseagreen'</span><span class="token punctuation">,</span> <span class="token string">'darkslategray'</span><span class="token punctuation">,</span> <span class="token string">'darkslategrey'</span><span class="token punctuation">,</span> <span class="token string">'teal'</span><span class="token punctuation">,</span> <span class="token string">'darkcyan'</span><span class="token punctuation">,</span> <span class="token string">'dodgerblue'</span><span class="token punctuation">,</span> <span class="token string">'navy'</span><span class="token punctuation">,</span> <span class="token string">'darkblue'</span><span class="token punctuation">,</span> <span class="token string">'mediumblue'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'slateblue'</span><span class="token punctuation">,</span> <span class="token string">'darkslateblue'</span><span class="token punctuation">,</span> <span class="token string">'mediumslateblue'</span><span class="token punctuation">,</span> <span class="token string">'mediumpurple'</span><span class="token punctuation">,</span> <span class="token string">'rebeccapurple'</span><span class="token punctuation">,</span> <span class="token string">'blueviolet'</span><span class="token punctuation">,</span> <span class="token string">'indigo'</span><span class="token punctuation">,</span> <span class="token string">'darkorchid'</span><span class="token punctuation">,</span> <span class="token string">'darkviolet'</span><span class="token punctuation">,</span> <span class="token string">'mediumorchid'</span><span class="token punctuation">,</span> <span class="token string">'purple'</span><span class="token punctuation">,</span> <span class="token string">'darkmagenta'</span><span class="token punctuation">,</span> <span class="token string">'fuchsia'</span><span class="token punctuation">,</span> <span class="token string">'magenta'</span><span class="token punctuation">,</span> <span class="token string">'orchid'</span><span class="token punctuation">,</span> <span class="token string">'mediumvioletred'</span><span class="token punctuation">,</span> <span class="token string">'deeppink'</span><span class="token punctuation">,</span> <span class="token string">'hotpink'</span><span class="token punctuation">]</span>
    markers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;v&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;^&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&lt;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&gt;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;8&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;P&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;h&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;H&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;+&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;|&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">]</span>
    linestyle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'--'</span><span class="token punctuation">,</span> <span class="token string">'-.'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">]</span>
    line_arg <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    line_arg<span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>colors<span class="token punctuation">)</span>
    <span class="token comment"># line_arg['marker'] = random.choice(markers)</span>
    line_arg<span class="token punctuation">[</span><span class="token string">'linestyle'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>linestyle<span class="token punctuation">)</span>
    line_arg<span class="token punctuation">[</span><span class="token string">'linewidth'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token comment"># line_arg['markersize'] = random.randint(3, 5)</span>
    <span class="token keyword">return</span> line_arg

<span class="token comment">#PR曲线</span>
<span class="token keyword">def</span> <span class="token function">plot_PR_curve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.01</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># plt.plot([0, 1], [0, 1],ls=&quot;--&quot;, c='.3', linewidth=3, label='随机模型')</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Recall'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Precision'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.size'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">22</span>
    plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;测试集预测结果.csv&quot;</span><span class="token punctuation">)</span>
    ap_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> each_class <span class="token keyword">in</span> idx_to_labels<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        y_test <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> each_class<span class="token punctuation">)</span><span class="token punctuation">)</span>
        y_score <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'class_{}_prob'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>each_class<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        precision<span class="token punctuation">,</span> recall<span class="token punctuation">,</span> thresholds <span class="token operator">=</span> precision_recall_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_score<span class="token punctuation">)</span>
        AP <span class="token operator">=</span> average_precision_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_score<span class="token punctuation">,</span> average<span class="token operator">=</span><span class="token string">'weighted'</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>recall<span class="token punctuation">,</span> precision<span class="token punctuation">,</span> <span class="token operator">**</span>get_line_arg<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token operator">=</span>each_class<span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ap_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>AP<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'各类别PR曲线.pdf'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    df_report <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'各类别准确率评估指标.csv'</span><span class="token punctuation">)</span>
    <span class="token comment"># 计算 AP值 的 宏平均 和 加权平均</span>
    macro_avg_auc <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>ap_list<span class="token punctuation">)</span>
    weighted_avg_auc <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>ap_list <span class="token operator">*</span> df_report<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'support'</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">)</span>
    ap_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>macro_avg_auc<span class="token punctuation">)</span>
    ap_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>weighted_avg_auc<span class="token punctuation">)</span>
    df_report<span class="token punctuation">[</span><span class="token string">'AP'</span><span class="token punctuation">]</span> <span class="token operator">=</span> ap_list
    <span class="token comment"># print(df_report)</span>
    df_report<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'各类别准确率评估指标.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h3 id="_1-5-roc曲线"><a href="#_1-5-roc曲线" class="header-anchor">#</a> 1.5. ROC曲线</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token comment">#ROC曲线</span>
<span class="token keyword">def</span> <span class="token function">plot_roc_curve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.01</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ls<span class="token operator">=</span><span class="token string">&quot;--&quot;</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token string">'.3'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'随机模型'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'False Positive Rate (1 - Specificity)'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True Positive Rate (Sensitivity)'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.size'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">22</span>
    plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'测试集预测结果.csv'</span><span class="token punctuation">)</span>
    auc_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> each_class <span class="token keyword">in</span> idx_to_labels<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        y_test <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'true_class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> each_class<span class="token punctuation">)</span><span class="token punctuation">)</span>
        y_score <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'class_{}_prob'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>each_class<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> threshold <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_score<span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">,</span> <span class="token operator">**</span>get_line_arg<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token operator">=</span>each_class<span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
        auc_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>auc<span class="token punctuation">(</span>fpr<span class="token punctuation">,</span> tpr<span class="token punctuation">)</span><span class="token punctuation">)</span>

    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'各类别ROC曲线.pdf'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    df_report <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'各类别准确率评估指标.csv'</span><span class="token punctuation">)</span>
    <span class="token comment"># 计算 AUC值 的 宏平均 和 加权平均</span>
    macro_avg_auc <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>auc_list<span class="token punctuation">)</span>
    weighted_avg_auc <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>auc_list <span class="token operator">*</span> df_report<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'support'</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">)</span>
    auc_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>macro_avg_auc<span class="token punctuation">)</span>
    auc_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>weighted_avg_auc<span class="token punctuation">)</span>
    df_report<span class="token punctuation">[</span><span class="token string">'AUC'</span><span class="token punctuation">]</span> <span class="token operator">=</span> auc_list
    <span class="token comment"># print(df_report)</span>
    df_report<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'各类别准确率评估指标.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_1-6-各类别评估指标柱状图"><a href="#_1-6-各类别评估指标柱状图" class="header-anchor">#</a> 1.6. 各类别评估指标柱状图</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token comment">#绘制各类别评估指标柱状图</span>
<span class="token keyword">def</span> <span class="token function">plot_bar_chart</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    绘制各类别评估指标柱状图
    :param df: DataFrame
    :param feature: str
    # feature = 'precision'
    # feature = 'recall'
    # feature = 'f1-score'
    # feature = 'accuracy'
    # feature = 'AP'
    # feature = 'AUC'
    :return:
    &quot;&quot;&quot;</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'各类别准确率评估指标.csv'</span><span class="token punctuation">)</span>
    df_plot <span class="token operator">=</span> df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span>feature<span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    x <span class="token operator">=</span> df_plot<span class="token punctuation">[</span><span class="token string">'类别'</span><span class="token punctuation">]</span>
    y <span class="token operator">=</span> df_plot<span class="token punctuation">[</span>feature<span class="token punctuation">]</span>
    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'#1f77b4'</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>bar_label<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> fmt<span class="token operator">=</span><span class="token string">'%.2f'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token comment"># 置信度数值</span>
    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>tick_params<span class="token punctuation">(</span>labelsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
    <span class="token comment"># plt.xlabel('类别', fontsize=20)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'评估指标 {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'各类别评估指标柱状图-{}.pdf'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># plot_bar_chart('AUC')</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_1-7-调用函数"><a href="#_1-7-调用函数" class="header-anchor">#</a> 1.7. 调用函数</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># # 根据 labels.csv 载入类别和对应 ID</span>
    <span class="token comment"># idx_to_labels = pd.read_csv(&quot;D:\SanYeQing_Project\wht-sanyeqing\idx_to_labels.csv&quot;,encoding='utf-8')</span>
    <span class="token comment"># # 创建一个字典来存储真实标签</span>
    <span class="token comment"># idx_to_labels = {str(index): row['labels'] for index, row in idx_to_labels.iterrows()}  </span>
    random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">124</span><span class="token punctuation">)</span>
    <span class="token comment">#根据json文件获取类别</span>
    <span class="token keyword">import</span> json
    class_json_path <span class="token operator">=</span> <span class="token string">'class_5.json'</span>
    json_file <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>class_json_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>
    idx_to_labels <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>json_file<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>idx_to_labels<span class="token punctuation">)</span>
    <span class="token comment"># 测试集预测结果、各类别准确率评估指标</span>
    predict_acc_all<span class="token punctuation">(</span>labels_path<span class="token operator">=</span><span class="token string">r&quot;D:\SanYeQing_Project\sanyeqing_hun_weizhi_finally\labels_hun_finally.csv&quot;</span><span class="token punctuation">,</span>
                        image_dir<span class="token operator">=</span><span class="token string">r&quot;D:\SanYeQing_Project\sanyeqing_hun_weizhi_finally\test_hun_finally&quot;</span><span class="token punctuation">,</span>
                        num_classes<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
                        model_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                        model_weight_pth<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                        classes<span class="token operator">=</span>idx_to_labels<span class="token punctuation">,</span>
                        model_leibie <span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                        model_path_zheng<span class="token operator">=</span><span class="token string">r&quot;D:\SanYeQing_Project\wht_sanyeqing_image-Classification\model_zheng_path\model_cpu_97.18.pth&quot;</span><span class="token punctuation">,</span>
                        is_zheng<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment">#混淆矩阵</span>
    cnf_matrix_plotter<span class="token punctuation">(</span>classes<span class="token operator">=</span>idx_to_labels<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'Blues'</span><span class="token punctuation">)</span>
    <span class="token comment">#PR曲线</span>
    plot_PR_curve<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#ROC曲线</span>
    plot_roc_curve<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#绘制各类别评估指标柱状图</span>
    plot_bar_chart<span class="token punctuation">(</span><span class="token string">'AUC'</span><span class="token punctuation">)</span>
    <span class="token comment">#筛选出测试集中，真实为A类，但被误判为B类的图像</span>
    get_wrong_predict<span class="token punctuation">(</span>true_A<span class="token operator">=</span><span class="token string">&quot;浙江省&quot;</span><span class="token punctuation">,</span>pred_B<span class="token operator">=</span><span class="token string">&quot;陕西省&quot;</span><span class="token punctuation">,</span>is_plt<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_wrong_predict<span class="token punctuation">(</span>true_A<span class="token operator">=</span><span class="token string">&quot;浙江省&quot;</span><span class="token punctuation">,</span>pred_B<span class="token operator">=</span><span class="token string">&quot;非浙江&quot;</span><span class="token punctuation">,</span>is_plt<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    

    
    <span class="token comment">#单张图片的预测概率 (可选看)</span>
    <span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageDraw<span class="token punctuation">,</span>ImageFont
    
   
    <span class="token keyword">import</span> os
    font_path <span class="token operator">=</span> <span class="token string">&quot;C:\\Windows\\Fonts\\simhei.ttf&quot;</span>  <span class="token comment"># 要检查的路径</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>font_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;路径存在&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;路径不存在&quot;</span><span class="token punctuation">)</span>
     <span class="token comment"># 创建一个 ImageFont 对象，设置字体大小</span>
    font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span>font_path<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">show_image</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;展示图像&quot;&quot;&quot;</span>
        plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
        <span class="token keyword">if</span> title<span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
        <span class="token comment">#  plt.axis('off')  # 不显示坐标轴</span>
        plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 在predict_函数调用之后，添加如下代码来显示图像 </span>
    img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r&quot;D:\SanYeQing_Project\sanyeqing_hun_weizhi_finally\test_hun_finally\2496.png&quot;</span><span class="token punctuation">)</span>
    predicted_class <span class="token punctuation">,</span>max_prob<span class="token punctuation">,</span>sorted_class_probs<span class="token operator">=</span> predict_<span class="token punctuation">(</span>img<span class="token punctuation">,</span> num_classes<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
                        model_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                        model_weight_pth<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                        classes<span class="token operator">=</span>idx_to_labels<span class="token punctuation">,</span>
                        model_leibie <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
                        model_path_zheng<span class="token operator">=</span><span class="token string">r&quot;D:\SanYeQing_Project\wht_sanyeqing_image-Classification\model_zheng_path\model_cpu_97.18.pth&quot;</span><span class="token punctuation">,</span>
                        is_zheng<span class="token operator">=</span><span class="token boolean">True</span>
                                            <span class="token punctuation">)</span>
    <span class="token comment"># 创建一个 ImageDraw 对象</span>
    draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token comment"># 定义起始位置</span>
    start_x <span class="token operator">=</span> <span class="token number">10</span>
    start_y <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token comment"># 定义行间距</span>
    line_spacing <span class="token operator">=</span> <span class="token number">15</span>
    <span class="token comment"># 将字典转换为列表</span>
    sorted_class_probs_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>sorted_class_probs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 遍历字典，将键和值添加到图像上</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> sorted_class_probs_list<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        key <span class="token operator">=</span> idx_to_labels<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span>
        text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">:       </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
        draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span>start_x<span class="token punctuation">,</span> start_y<span class="token punctuation">)</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> fill<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>font<span class="token operator">=</span>font<span class="token punctuation">)</span>
        start_y <span class="token operator">+=</span> line_spacing  <span class="token comment"># 更新y坐标，以便下一行文本在新的一行</span>
    <span class="token comment"># 显示图像</span>
    show_image<span class="token punctuation">(</span>img<span class="token punctuation">)</span>  
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;最可能的类别：</span><span class="token interpolation"><span class="token punctuation">{</span>predicted_class<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;最大分类概率：</span><span class="token interpolation"><span class="token punctuation">{</span>max_prob<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sorted_class_probs<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><h2 id="二、测试集图像语义特征可视化"><a href="#二、测试集图像语义特征可视化" class="header-anchor">#</a> 二、测试集图像语义特征可视化</h2> <blockquote><p>更多信息查看对应文档，这里不再赘述</p></blockquote> <p><img src="/docs_img/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/16f9fdac0e1546c9964ca2b05f7b4bfa.png" alt="在这里插入图片描述"></p> <h3 id="_2-1-计算测试集图像的语义特征"><a href="#_2-1-计算测试集图像的语义特征" class="header-anchor">#</a> 2.1. 计算测试集图像的语义特征</h3> <h3 id="_2-2-使用t-sne算法进行降维可视化"><a href="#_2-2-使用t-sne算法进行降维可视化" class="header-anchor">#</a> 2.2. 使用t-SNE算法进行降维可视化</h3> <h3 id="_2-3-使用umap算法进行降维可视化"><a href="#_2-3-使用umap算法进行降维可视化" class="header-anchor">#</a> 2.3. 使用UMAP算法进行降维可视化</h3> <h2 id="三、特征图的展示-补充"><a href="#三、特征图的展示-补充" class="header-anchor">#</a> 三、特征图的展示（补充）</h2> <blockquote><p>更多信息查看对应文档，这里不再赘述</p></blockquote> <hr> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>本文主要介绍了在测试集上进行模型评估的代码，以及测试集图像语义特征可视化等</p> <p>2024/6/12</p> <p><section style="border-top:2px solid #eaecef;padding-top:1rem;margin-top:2rem;"><div><span data-flag-title="Your Article Title" class="leancloud-visitors"><em class="post-meta-item-text">阅读量： </em> <i class="leancloud-visitors-count"></i></span></div> <h3><a href="javascript:;"></a>
    评 论：
</h3> <div id="vcomments"></div></section></p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/三叶青图像识别项目/【3】迁移学习模型.html" class="prev">
          【3】迁移学习模型
        </a></span> <span class="next"><a href="/docs/三叶青图像识别项目/【6】图像分类部署.html">
          【6】图像分类部署
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#前言" class="sidebar-link reco-side-前言" data-v-b57cc07c>前言</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#一、评估指标代码" class="sidebar-link reco-side-一、评估指标代码" data-v-b57cc07c>一、评估指标代码</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_1-1-各类别准确率评估指标" class="sidebar-link reco-side-_1-1-各类别准确率评估指标" data-v-b57cc07c>1.1. 各类别准确率评估指标</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_1-2-混淆矩阵可视化" class="sidebar-link reco-side-_1-2-混淆矩阵可视化" data-v-b57cc07c>1.2. 混淆矩阵可视化</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_1-3-真实为a类-但被误判为b类的图像" class="sidebar-link reco-side-_1-3-真实为a类-但被误判为b类的图像" data-v-b57cc07c>1.3. 真实为A类，但被误判为B类的图像</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_1-4-pr曲线" class="sidebar-link reco-side-_1-4-pr曲线" data-v-b57cc07c>1.4. PR曲线</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_1-5-roc曲线" class="sidebar-link reco-side-_1-5-roc曲线" data-v-b57cc07c>1.5. ROC曲线</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_1-6-各类别评估指标柱状图" class="sidebar-link reco-side-_1-6-各类别评估指标柱状图" data-v-b57cc07c>1.6. 各类别评估指标柱状图</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_1-7-调用函数" class="sidebar-link reco-side-_1-7-调用函数" data-v-b57cc07c>1.7. 调用函数</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#二、测试集图像语义特征可视化" class="sidebar-link reco-side-二、测试集图像语义特征可视化" data-v-b57cc07c>二、测试集图像语义特征可视化</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_2-1-计算测试集图像的语义特征" class="sidebar-link reco-side-_2-1-计算测试集图像的语义特征" data-v-b57cc07c>2.1. 计算测试集图像的语义特征</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_2-2-使用t-sne算法进行降维可视化" class="sidebar-link reco-side-_2-2-使用t-sne算法进行降维可视化" data-v-b57cc07c>2.2. 使用t-SNE算法进行降维可视化</a></li><li class="level-3" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#_2-3-使用umap算法进行降维可视化" class="sidebar-link reco-side-_2-3-使用umap算法进行降维可视化" data-v-b57cc07c>2.3. 使用UMAP算法进行降维可视化</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#三、特征图的展示-补充" class="sidebar-link reco-side-三、特征图的展示-补充" data-v-b57cc07c>三、特征图的展示（补充）</a></li><li class="level-2" data-v-b57cc07c><a href="/docs/%E4%B8%89%E5%8F%B6%E9%9D%92%E5%9B%BE%E5%83%8F%E8%AF%86%E5%88%AB%E9%A1%B9%E7%9B%AE/%E3%80%904%E3%80%91%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%9B%86%E4%B8%8A%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B%E7%B2%BE%E5%BA%A6.html#总结" class="sidebar-link reco-side-总结" data-v-b57cc07c>总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="/music/冬眠-司南.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:400px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://p1.music.126.net/qTSIZ27qiFvRoKj-P30BiA==/109951165895951287.jpg?param=200y200" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://p1.music.126.net/qTSIZ27qiFvRoKj-P30BiA==/109951165895951287.jpg?param=200y200);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>冬眠</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>司南</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><div></div></div></div>
    <script src="/assets/js/app.94050fe9.js" defer></script><script src="/assets/js/3.1d401efd.js" defer></script><script src="/assets/js/1.5d58ef4f.js" defer></script><script src="/assets/js/26.91340062.js" defer></script><script src="/assets/js/13.97938b40.js" defer></script><script src="/assets/js/10.ea0a4944.js" defer></script>
  </body>
</html>
